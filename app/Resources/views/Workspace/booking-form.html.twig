{% extends "layout.html.twig" %}

{% block title %}
  {{ parent() }} - Réservation
{% endblock %}

{% block stylesheets %}
	
{% endblock %}

{% block body %} 




<div class="container-fluid" id="bookingPage">
	{{ form_start(bookingForm) }}
{# Le contenu de la form est construit dans booking.js #}
	<div class="row text-center">
		<div class="col-lg-9">
		{# 	{% for p in pictures %}
		    	{% if p.isFavorite %}
		      		<img src="{{ asset('images/Workspaces/') }}{{ws.name}}/{{p.url}}" alt="{{ws.name}}" width="100%">
		    	{% endif %}
		  	{% endfor %} #}
		  	<img src="{{ asset('images/icons/booking-guy.png') }}" alt="{{ws.name}}" width="103%">
		</div>
	</div>
	<div class="row">
			<div class="col-lg-2 panelAdresse">
				<br>
				<strong>{{ws.name}}</strong> <br>
				{{ws.street|capitalize}} <br> 
				{{ws.postCode}} {{ws.city|capitalize}} <br>
				{% if averageVote > 0 %} {{averageVote|rating}} {% endif %}
			</div>
			<div class="col-lg-7 panelForm">

				{# EMAIL non renseigné #}
				{% if is_granted("IS_AUTHENTICATED_REMEMBERED") and app.user.email == "" %}
					<div id="email-error">
						<div class="alert alert-danger alert-dismissable fade in">
						  <h4><i class="icon icon-times-circle icon-lg"></i> Aucun email renseigné</h4>
						  <p>ATTENTION, vous devez renseigner votre email dans <a href="{{ path('fos_user_profile_edit') }}">votre profil</a>, afin de valider la réservation.</p>
						</div>
						
					</div>
				{% endif %}

				
				<center><h3>Choisir un créneau de réservation</h3></center>

				{% set nbDuration = 0 %}
				<div class="segmented-control" style="color: #20385e;border: none;" id="booking-duration">
					{% if prices.priceHour != null %}
						{% set nbDuration = nbDuration + 1 %}
							{% if nbDuration == 1 %}
								<input type="radio" name="booking-duration" id="booking-duration-Heure" value="Heure" checked="true">
							{% else %}
								<input type="radio" name="booking-duration" id="booking-duration-Heure" value="Heure">
							{% endif %}
						<label for="booking-duration-Heure" data-value="Heure">Heure</label>
					{% endif %}

					{% if prices.priceHalfDay != null %}
						{% set nbDuration = nbDuration + 1 %}
							{% if nbDuration == 1 %}
								<input type="radio" name="booking-duration" id="booking-duration-HalfDay" value="Demi journée" checked="true">
							{% else %}
								<input type="radio" name="booking-duration" id="booking-duration-HalfDay" value="Demi journée">
							{% endif %}
						<label for="booking-duration-HalfDay" data-value="Demi journée">Demi journée</label>
					{% endif %}

					{% if prices.priceDay != null %}
						{% set nbDuration = nbDuration + 1 %}
							{% if nbDuration == 1 %}
								<input type="radio" name="booking-duration" id="booking-duration-Day" value="Journée" checked="true">
							{% else %}
								<input type="radio" name="booking-duration" id="booking-duration-Day" value="Journée">
							{% endif %}
						<label for="booking-duration-Day" data-value="Journée">Journée</label>
					{% endif %}

					{% if prices.priceWeek != null %}
						{% set nbDuration = nbDuration + 1 %}
							{% if nbDuration == 1 %}
								<input type="radio" name="booking-duration" id="booking-duration-Week" value="Semaine" checked="true">
							{% else %}
								<input type="radio" name="booking-duration" id="booking-duration-Week" value="Semaine">
							{% endif %}
						<label for="booking-duration-Week" data-value="Semaine">Semaine</label>
					{% endif %}

					{% if prices.priceMonth != null %}
						{% set nbDuration = nbDuration + 1 %}
							{% if nbDuration == 1 %}
								<input type="radio" name="booking-duration" id="booking-duration-Month" value="Mois" checked="true">
							{% else %}
								<input type="radio" name="booking-duration" id="booking-duration-Month" value="Mois">
							{% endif %}
						<label for="booking-duration-Month" data-value="Mois">Mois</label>
					{% endif %}
				</div>
				<div id="isOpenSaturday" style="display:none">{{times.isOpenSaturday}}</div>
				<div id="isOpenSunday" style="display:none">{{times.isOpenSunday}}</div> 
				<div id="closedDates" style="display:none">{% for d in closedDates %}{{- d.closedDate.date|date("d/m/Y") -}},{% endfor %}</div> {# TO DO vérifier que ca marche et finir #}

				{# CALENDAR #}
				<input type="text" name="booking-calendar" id="booking-calendar" hidden="true" />
				<div id='calendarContainer'></div>
				<br>
				<span id="calendar-error"></span>

				{# HORAIRE #}
				<div id="openHour" style="display:none">{{times.openHour|date('H:i')}}</div> 
				<div id="closeHour" style="display:none">{{times.closeHour|date('H:i')}}</div> 
				<span id="calendar-time" style="display:none"> {# caché par défaut, affiché en JS si besoin #}
				Horaire : 
				    <strong><span id="time-min"></span></strong>
				    <span class="slideTime">
				    	<input id="booking-time-slider" type="text" data-slider-handle="custom" name="booking-time-slider" />
				    </span>
				    <strong><span id="time-max"></span></strong>
				    <span id="nbHeures" hidden="true">1</span>
				    <br><br>
				</span>
				{# 1/2 JOURNEE #}
				<span id="calendar-halftime" style="display:none">	 {# caché par défaut, affiché en JS si besoin #}
				    <div class="segmented-control" style="width: 300px; color: #20385e" id="booking-duration-day">
					  <input type="radio" name="booking-duration-day" id="booking-duration-day-1" checked value="Matin">
					  <input type="radio" name="booking-duration-day" id="booking-duration-day-2" value="Après-midi">
					  <label for="booking-duration-day-1" data-value="Matin">Matin</label>
					  <label for="booking-duration-day-2" data-value="Après-midi">Après-midi</label>
					</div>
				    <br>
				<br>
				</span>
				{# TO DO : min et max en fonction des places dispos #}
				{# Nb PEOPLE #}

				{% if WsHasOffice.office.name == 'Open space' %}
					Nombre de coworkers : 
				{% else %}
					Nombre de coworkers (à titre indicatif) : 
				{% endif %}

				<span class="slidePeople">
				<b> 1 </b>
					<input id="booking-people" type="text" data-slider-handle="custom" data-slider-min="1" data-slider-max="{{WsHasOffice.deskQty}}" data-slider-value="1" name="booking-people"/>
				<b> {{WsHasOffice.deskQty}} </b>
				</span>

				<br><br>
				{# msg #}
				Vous pouvez adresser ici un message à {{ws.name}} : <br>
				{{form_row(bookingForm.message)}}
			</div>
			<div class="col-lg-2 panelRecap">

				<center>- <span id="spaceName">{{WsHasOffice.name|upper}}</span> - </center>
						{# Capacité ou Quantité 
						<span class="capacity" id="capacity">
						{% if WsHasOffice.office.name == 'Open space' %}
							Quantité : {{WsHasOffice.deskQty}} <i class="fa fa-briefcase" aria-hidden="true"></i>
						{% else %}
							Capacité : {{WsHasOffice.deskQty}} <i class="fa fa-male" aria-hidden="true"></i>
						{% endif %}
						</span> #}
				<br>
				<img src="{{ asset('images/Workspaces/') }}{{ws.name}}/{{WsHasOffice.UrlProfilePicture}}" alt="{{ws.name}}" width="100%">
				<br>
				<br>
				<center>- VOTRE RESERVATION - </center><br>
				N° : {{ bookingForm.bookingRef.vars.value }} <br>
				Du <span id="recapDate"></span> <br>
				Nombre de coworker(s) : <span id="nbPeople">1</span> <br>
				<br>
				{# Prices #}
				<span id="priceHeure" hidden="true">{{prices.priceHour}}</span>
				<span id="priceDemi journée" hidden="true">{{prices.priceHalfDay}}</span>
				<span id="priceJournée" hidden="true">{{prices.priceDay}}</span>
				<span id="priceSemaine" hidden="true">{{prices.priceWeek}}</span>
				<span id="priceMois" hidden="true">{{prices.priceMonth}}</span>
				<span id="officeType" hidden="true">{{WsHasOffice.office.name}}</span>
				<span id="tva" hidden="true">{{tva}}</span>

				{# J'ai besoin que le price soit dans un input pour le récupérer depuis le controller #}
				<input id="price-excl-tax" type="number" step="any" name="price-excl-tax" value="" hidden="true"  form="booking">
				<input id="price-incl-tax" type="number" step="any" name="price-incl-tax" value="" hidden="true">
				<span id="price"><span id="price-excl-tax-div"></span> € HT (soit <span id="price-incl-tax-div"></span> € TTC)</span>
				{{form_row(bookingForm.confirmer)}}

			</div>

	</div>
	

	{{ form_rest(bookingForm) }}
	{{ form_end(bookingForm) }}
</div>



{% endblock body %}

{% block javascripts %}    
	<script type="text/javascript" src="{{ asset('js/moment.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/jquery.daterangepicker.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('js/booking.js') }}"></script>
	
{% endblock javascripts %} 
